<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Streams - Conteúdo por Gênero</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #0f0f0f;
            color: #e1e1e1;
            font-family: 'Inter', sans-serif;
        }
        .content-card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            background-color: #1f2937;
            border-radius: 0.5rem;
            overflow: hidden;
            transform: perspective(1px) translateZ(0);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            border: 1px solid transparent;
        }
        .content-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 15px rgba(229, 9, 20, 0.3);
            border-color: rgba(229, 9, 20, 0.5);
        }
        .content-card img {
            aspect-ratio: 2/3;
            object-fit: cover;
            width: 100%;
            height: auto;
            transition: filter 0.3s ease-in-out;
        }
        .content-card:hover img { filter: brightness(0.75); }
        .content-card .title-bg { background-color: rgba(15, 15, 15, 0.9); }
        .content-card .title-text { color: #e1e1e1; transition: color 0.3s ease-in-out; }
        .content-card:hover .title-text { color: #ffffff; }
        .btn-more { transition: background-color 0.3s ease, transform 0.2s ease; }
        .btn-more:hover { transform: translateY(-1px); }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background-color: #404040; border-radius: 4px; border: 2px solid #1a1a1a; }
        ::-webkit-scrollbar-thumb:hover { background-color: #555; }
    </style>
</head>
<body class="antialiased">

    <header class="bg-gradient-to-b from-black/90 via-black/70 to-transparent sticky top-0 z-50 py-3 sm:py-4 px-4 sm:px-6">
        <nav class="container mx-auto px-0 sm:px-6 flex flex-wrap justify-between items-center">
            <a href="#" class="text-2xl sm:text-3xl font-bold text-red-600 tracking-wide hover:text-red-500 transition duration-300">Nexus Streams</a>
            <div class="space-x-3 sm:space-x-5 mt-2 sm:mt-0">
                <a href="#content-container" class="text-gray-300 hover:text-white transition duration-200 text-sm sm:text-base font-medium">Filmes</a>
                <a href="#content-container" class="text-gray-300 hover:text-white transition duration-200 text-sm sm:text-base font-medium">Séries</a>
            </div>
        </nav>
    </header>

    <section class="container mx-auto px-4 sm:px-6 py-8 md:py-12 text-center bg-gray-900/30 rounded-lg mb-10 mt-4 sm:mb-12 shadow-lg border border-gray-800/50">
        <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-white mb-3 sm:mb-4">Bem-vindo à Nexus Streams</h1>
        <p class="text-base sm:text-lg text-gray-300 mb-6 sm:mb-8 max-w-2xl mx-auto">Explore filmes e séries populares, organizados por gênero.</p>
        <div class="max-w-lg mx-auto px-2 sm:px-0">
             <div class="relative">
                 <input type="search" placeholder="Buscar filmes ou séries..." disabled class="w-full py-2.5 px-4 sm:py-3 sm:px-5 bg-gray-800/70 border border-gray-700 rounded-full text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-red-600 focus:border-transparent transition duration-300 shadow-sm text-sm sm:text-base cursor-not-allowed opacity-50">
                 <svg class="absolute right-4 top-1/2 transform -translate-y-1/2 h-4 w-4 sm:h-5 sm:w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
             </div>
        </div>
    </section>

    <main class="container mx-auto px-4 sm:px-6">
        <section id="content-container" class="mb-12 sm:mb-16">
            <h2 class="text-2xl sm:text-3xl font-semibold mb-6 sm:mb-8 text-white border-l-4 border-red-600 pl-3 sm:pl-4">Conteúdo Popular por Gênero</h2>
            <p id="loading-geral" class="text-gray-400">Carregando gêneros, filmes e séries...</p>
            </section>

        <div class="flex flex-col sm:flex-row justify-center items-center gap-4 mt-8 sm:mt-10">
             <button class="btn-more bg-gray-700 hover:bg-gray-600 text-gray-200 font-semibold py-2 px-5 sm:px-6 rounded-full inline-flex items-center text-sm w-full sm:w-auto justify-center" onclick="window.open('https://www.themoviedb.org/movie', '_blank')">
                 Ver todos os filmes populares no TMDb
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 sm:h-4 sm:w-4 ml-1.5 sm:ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
             </button>
             <button class="btn-more bg-gray-700 hover:bg-gray-600 text-gray-200 font-semibold py-2 px-5 sm:px-6 rounded-full inline-flex items-center text-sm w-full sm:w-auto justify-center" onclick="window.open('https://www.themoviedb.org/tv', '_blank')">
                 Ver todas as séries populares no TMDb
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 sm:h-4 sm:w-4 ml-1.5 sm:ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
             </button>
        </div>
    </main>

    <footer class="bg-black mt-12 sm:mt-16 py-6 sm:py-8 border-t border-gray-800">
        <div class="container mx-auto px-4 sm:px-6 text-center text-gray-500 text-xs sm:text-sm">
            &copy; <span id="current-year"></span> Nexus Streams. Todos os direitos reservados.
        </div>
    </footer>

    <script>
        // --- Constantes Globais ---
        const TMDb_API_BASE_URL = 'https://api.themoviedb.org/3';
        const TMDb_API_URL_POPULAR_MOVIES = `${TMDb_API_BASE_URL}/movie/popular?language=pt-BR&page=1`;
        const TMDb_API_URL_TOP_RATED_TV = `${TMDb_API_BASE_URL}/tv/top_rated?language=pt-BR&page=1`;
        const TMDb_API_URL_GENRES = `${TMDb_API_BASE_URL}/genre/movie/list?language=pt-BR`;
        const TMDb_IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/w500';
        const TMDb_PLACEHOLDER_IMAGE = 'https://placehold.co/500x750/374151/9CA3AF?text=Poster+Indispon%C3%ADvel';
        const TMDb_OPTIONS = {
            method: 'GET',
            headers: {
                accept: 'application/json',
                // IMPORTANTE: Substitua pelo seu Bearer Token da API TMDb
                Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIwMGU4NjljODc4YzVlYzQ0OTg0NmNjNjhmNTBkOWMwZCIsIm5iZiI6MTc0NTI1OTc2OC4xNTIsInN1YiI6IjY4MDY4Y2Y4YjY1OTgyMjgxMmVlNjhkOSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.Owiv7fvIAoRGKoNE7erZsAypbofV2kJcDhdWmZ4-LX8'
            }
        };
        let genreMap = {}; // Mapa ID -> Nome do Gênero

        // --- Funções de Busca na API ---

        /** Busca lista de gêneros */
        async function fetchGenres(apiUrl, apiOptions) {
            console.log("Buscando gêneros...");
            try {
                const response = await fetch(apiUrl, apiOptions);
                if (!response.ok) throw new Error(`Erro HTTP ${response.status} ao buscar gêneros`);
                const data = await response.json();
                if (data.genres && data.genres.length > 0) {
                    data.genres.forEach(genre => { genreMap[genre.id] = genre.name; });
                    console.log("Mapa de gêneros criado:", genreMap);
                    return true;
                } else {
                    console.warn('Nenhum gênero encontrado.'); return false;
                }
            } catch (error) {
                console.error(`Falha ao buscar/processar gêneros (${apiUrl}):`, error); return false;
            }
        }

        /** Busca dados genéricos (filmes/séries) */
        async function fetchTMDbData(apiUrl, contentType, apiOptions) {
            console.log(`Buscando ${contentType}...`);
            try {
                const response = await fetch(apiUrl, apiOptions);
                if (!response.ok) throw new Error(`Erro HTTP ${response.status} ao buscar ${contentType}`);
                const data = await response.json();
                if (data.results && data.results.length > 0) {
                    console.log(`Encontrados ${data.results.length} ${contentType}.`); return data.results;
                } else {
                    console.warn(`Nenhum ${contentType} encontrado na API: ${apiUrl}`); return [];
                }
            } catch (error) {
                console.error(`Falha ao buscar/processar ${contentType} (${apiUrl}):`, error); return null;
            }
        }

        // --- Funções de Busca de Detalhes (Novas) ---

        /** Busca detalhes gerais de uma série */
        async function fetchSeriesDetails(seriesId) {
            const apiUrl = `${TMDb_API_BASE_URL}/tv/${seriesId}?language=pt-BR&append_to_response=credits,images,videos`; // Trazendo mais dados
            console.log(`Buscando detalhes para a série ID: ${seriesId}`);
            try {
                const response = await fetch(apiUrl, TMDb_OPTIONS);
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    console.error(`Erro API TMDb (Detalhes Série ${seriesId}):`, response.status, response.statusText, errorData);
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                const data = await response.json();
                console.log(`Detalhes da série ${seriesId}:`, data);
                return data;
            } catch (error) {
                console.error(`Falha ao buscar detalhes da série (${seriesId}):`, error); return null;
            }
        }

        /** Busca detalhes de uma temporada */
        async function fetchSeasonDetails(seriesId, seasonNumber) {
            const apiUrl = `${TMDb_API_BASE_URL}/tv/${seriesId}/season/${seasonNumber}?language=pt-BR&append_to_response=credits,images,videos`;
            console.log(`Buscando detalhes para Série ${seriesId}, Temporada ${seasonNumber}`);
            try {
                const response = await fetch(apiUrl, TMDb_OPTIONS);
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    console.error(`Erro API TMDb (Detalhes Temporada ${seriesId}/${seasonNumber}):`, response.status, errorData);
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                const data = await response.json();
                console.log(`Detalhes da Temporada ${seasonNumber} (Série ${seriesId}):`, data);
                return data; // Inclui data.episodes
            } catch (error) {
                console.error(`Falha ao buscar detalhes da temporada (${seriesId}/${seasonNumber}):`, error); return null;
            }
        }

        /** Busca detalhes de um episódio */
        async function fetchEpisodeDetails(seriesId, seasonNumber, episodeNumber) {
            const apiUrl = `${TMDb_API_BASE_URL}/tv/${seriesId}/season/${seasonNumber}/episode/${episodeNumber}?language=pt-BR&append_to_response=credits,images,videos`;
            console.log(`Buscando detalhes para Série ${seriesId}, T${seasonNumber}E${episodeNumber}`);
             try {
                const response = await fetch(apiUrl, TMDb_OPTIONS);
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    console.error(`Erro API TMDb (Detalhes Episódio ${seriesId}/T${seasonNumber}E${episodeNumber}):`, response.status, errorData);
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                const data = await response.json();
                console.log(`Detalhes do Episódio T${seasonNumber}E${episodeNumber}:`, data);
                return data; // Inclui videos e images se o append_to_response funcionar corretamente
            } catch (error) {
                console.error(`Falha ao buscar detalhes do episódio (${seriesId}/T${seasonNumber}E${episodeNumber}):`, error); return null;
            }
        }

        // --- Funções de Processamento e Exibição ---

        /** Agrupa conteúdo (filmes/séries) por gênero */
        function groupContentByGenre(contentList) {
            const contentByGenre = {};
            if (!contentList || contentList.length === 0) return contentByGenre;

            contentList.forEach(item => {
                if (item.genre_ids && item.genre_ids.length > 0) {
                    item.genre_ids.forEach(genreId => {
                        const genreName = genreMap[genreId];
                        if (genreName) {
                            if (!contentByGenre[genreName]) contentByGenre[genreName] = [];
                            contentByGenre[genreName].push(item);
                        } else {
                             console.warn(`ID de gênero ${genreId} não encontrado para "${item.displayName}" (ID: ${item.id})`);
                        }
                    });
                } else {
                     // Adiciona a "Sem Gênero" ou ignora
                     // console.warn(`Item "${item.displayName}" (ID: ${item.id}) sem gênero.`);
                }
            });
            console.log("Conteúdo agrupado:", contentByGenre);
            return contentByGenre;
        }

        /** Cria o card HTML para um filme ou série */
        function createContentCard(item) {
            const element = document.createElement('div');
            element.className = 'content-card group cursor-pointer'; // Adiciona cursor-pointer

            const posterUrl = item.poster_path ? `${TMDb_IMAGE_BASE_URL}${item.poster_path}` : TMDb_PLACEHOLDER_IMAGE;
            const displayName = item.displayName || 'Título Indisponível';

            // Define o HTML interno
            element.innerHTML = `
                <div class="relative">
                    <img src="${posterUrl}" alt="Pôster de ${displayName}" loading="lazy" onerror="this.onerror=null; this.src='${TMDb_PLACEHOLDER_IMAGE}';">
                    <div class="absolute inset-0 bg-black opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                    ${item.type === 'tv' ? '<span class="absolute top-2 right-2 bg-blue-600 text-white text-xs font-semibold px-1.5 py-0.5 rounded">Série</span>' : ''}
                    ${item.type === 'movie' ? '<span class="absolute top-2 right-2 bg-red-600 text-white text-xs font-semibold px-1.5 py-0.5 rounded">Filme</span>' : ''}
                 </div>
                <div class="title-bg p-2 sm:p-3 text-center">
                    <span class="title-text text-xs sm:text-sm font-semibold block truncate" title="${displayName}">${displayName}</span>
                </div>
            `;

            // --- MODIFICAÇÃO DO CLIQUE ---
            if (item.type === 'tv') {
                // Clique em SÉRIE: Busca detalhes e mostra no console
                element.onclick = async () => {
                    console.log(`Clicou na série: ${item.displayName} (ID: ${item.id}). Buscando detalhes...`);
                    // Adiciona feedback visual de loading (opcional)
                    element.style.cursor = 'wait';
                    element.style.opacity = '0.7';

                    try {
                        const seriesDetails = await fetchSeriesDetails(item.id); // Busca detalhes da série

                        if (seriesDetails) {
                             // -------- PONTO DE EXIBIÇÃO NA UI (FUTURO) --------
                             // Aqui você chamaria uma função para mostrar os 'seriesDetails'
                             // em um modal, expandir o card, etc.
                             // Exemplo: displaySeriesModal(seriesDetails);
                             // --------------------------------------------------

                             // Feedback simples para o usuário agora:
                             alert(`Detalhes da série "${seriesDetails.name}" carregados!\n\nAbra o console do navegador (F12) para ver os dados completos (temporadas, elenco, etc.).`);
                             // Você pode descomentar as linhas abaixo para buscar a 1ª temporada como teste:
                             // if(seriesDetails.seasons && seriesDetails.seasons.length > 0) {
                             //    const firstSeason = seriesDetails.seasons.find(s => s.season_number > 0) || seriesDetails.seasons[0]; // Pega T1 ou a primeira da lista
                             //    if(firstSeason) {
                             //       await fetchSeasonDetails(item.id, firstSeason.season_number); // Busca detalhes da 1ª temporada
                             //    }
                             // }

                        } else {
                             alert(`Não foi possível carregar detalhes para a série "${item.displayName}". Verifique o console para erros.`);
                        }
                    } catch (error) {
                         console.error("Erro no manipulador de clique da série:", error);
                         alert(`Ocorreu um erro ao buscar detalhes da série "${item.displayName}".`);
                    } finally {
                         // Remove feedback visual de loading
                         element.style.cursor = 'pointer';
                         element.style.opacity = '1';
                    }
                };
            } else {
                // Clique em FILME: Abre link externo do TMDb
                const tmdbUrl = `https://www.themoviedb.org/movie/${item.id}?language=pt-BR`;
                element.onclick = () => window.open(tmdbUrl, '_blank');
            }
            // --- FIM DA MODIFICAÇÃO DO CLIQUE ---

            return element;
        }

        /** Exibe o conteúdo agrupado na página */
        function displayContentByGenre(groupedContent, containerId, loadingId) {
            const container = document.getElementById(containerId);
            const loadingMessage = document.getElementById(loadingId);

            if (!container) { console.error(`Container #${containerId} não encontrado.`); return; }
            if (loadingMessage && loadingMessage.parentNode) loadingMessage.remove();

            container.innerHTML = ''; // Limpa container

            // Readiciona título principal
            const mainTitle = document.createElement('h2');
            mainTitle.className = 'text-2xl sm:text-3xl font-semibold mb-6 sm:mb-8 text-white border-l-4 border-red-600 pl-3 sm:pl-4';
            mainTitle.textContent = 'Conteúdo Popular por Gênero';
            container.appendChild(mainTitle);

            const genreNames = Object.keys(groupedContent).sort();

            if (genreNames.length === 0) {
                container.innerHTML += `<p class="text-gray-400 text-center">Nenhum conteúdo encontrado para exibir.</p>`;
                return;
            }

            genreNames.forEach(genreName => {
                const genreSection = document.createElement('section');
                genreSection.className = 'mb-10';

                const genreTitle = document.createElement('h3');
                genreTitle.className = 'text-xl sm:text-2xl font-semibold mb-4 sm:mb-6 text-white border-l-4 border-red-500 pl-3 sm:pl-4';
                genreTitle.textContent = genreName;
                genreSection.appendChild(genreTitle);

                const contentGrid = document.createElement('div');
                contentGrid.className = 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6';

                groupedContent[genreName].forEach(item => {
                    const cardElement = createContentCard(item); // Chama a função de card atualizada
                    contentGrid.appendChild(cardElement);
                });

                genreSection.appendChild(contentGrid);
                container.appendChild(genreSection);
            });
        }

        /** Atualiza o ano no rodapé */
        function updateFooterYear() {
            const yearSpan = document.getElementById('current-year');
            if (yearSpan) yearSpan.textContent = new Date().getFullYear();
        }

        // --- Ponto de Entrada Principal ---
        document.addEventListener('DOMContentLoaded', async () => {
            const mainContainerId = 'content-container';
            const loadingMessageId = 'loading-geral';
            const loadingElement = document.getElementById(loadingMessageId);
            const container = document.getElementById(mainContainerId);

            if (!container) {
                 console.error(`Container principal #${mainContainerId} não encontrado!`);
                 if (loadingElement && loadingElement.parentNode) loadingElement.remove();
                 updateFooterYear(); return;
            }
            if (!loadingElement) console.warn(`Elemento de loading #${loadingMessageId} não encontrado.`);

            console.log("Iniciando busca de dados...");

            // 1. Busca Gêneros
            const genresFetched = await fetchGenres(TMDb_API_URL_GENRES, TMDb_OPTIONS);
            if (!genresFetched) {
                 const errorMsg = 'Erro: Falha ao carregar gêneros. Exibição comprometida.';
                 if(loadingElement) {
                     loadingElement.textContent = errorMsg;
                     loadingElement.classList.add('text-red-500', 'font-semibold');
                 } else { container.innerHTML = `<p class="text-red-500 font-semibold text-center">${errorMsg}</p>`; }
                 updateFooterYear(); return;
            }

            // 2. Busca Filmes e Séries em Paralelo
            console.log("Buscando filmes e séries...");
            const results = await Promise.allSettled([
                fetchTMDbData(TMDb_API_URL_POPULAR_MOVIES, 'Filmes Populares', TMDb_OPTIONS),
                fetchTMDbData(TMDb_API_URL_TOP_RATED_TV, 'Séries Populares', TMDb_OPTIONS)
            ]);

            let combinedContent = [];
            let fetchErrors = [];

            // Processa Filmes
            if (results[0].status === 'fulfilled' && results[0].value !== null) {
                 results[0].value.forEach(movie => combinedContent.push({ id: movie.id, displayName: movie.title, poster_path: movie.poster_path, genre_ids: movie.genre_ids, type: 'movie' }));
            } else { fetchErrors.push("filmes"); console.error("Falha ao buscar filmes:", results[0].reason); }

            // Processa Séries
            if (results[1].status === 'fulfilled' && results[1].value !== null) {
                 results[1].value.forEach(tv => combinedContent.push({ id: tv.id, displayName: tv.name, poster_path: tv.poster_path, genre_ids: tv.genre_ids, type: 'tv' }));
            } else { fetchErrors.push("séries"); console.error("Falha ao buscar séries:", results[1].reason); }

            // 3. Exibe Conteúdo ou Mensagem de Erro/Vazio
            if (combinedContent.length > 0) {
                 if (fetchErrors.length > 0) {
                     const warningDiv = document.createElement('p');
                     warningDiv.className = 'text-yellow-500 text-center mb-4 font-medium';
                     warningDiv.textContent = `Atenção: Não foi possível carregar ${fetchErrors.join(' e ')}. Exibindo conteúdo disponível.`;
                     // Insere antes do título H2 que será adicionado por displayContentByGenre
                     if (container.firstChild) container.insertBefore(warningDiv, container.firstChild);
                     else container.appendChild(warningDiv);
                     console.warn(warningDiv.textContent);
                 }
                 const groupedContent = groupContentByGenre(combinedContent);
                 displayContentByGenre(groupedContent, mainContainerId, loadingMessageId); // Remove loading e exibe
            } else {
                 let finalMessage = "Nenhum filme ou série popular encontrado.";
                 if (fetchErrors.length === 2) finalMessage = `Erro: Falha ao carregar ${fetchErrors.join(' e ')}.`;
                 if (loadingElement && loadingElement.parentNode) loadingElement.remove();
                 container.innerHTML = ''; // Limpa
                 const finalMsgElement = document.createElement('p');
                 finalMsgElement.className = fetchErrors.length === 2 ? 'text-red-500 font-semibold text-center' : 'text-gray-400 text-center';
                 finalMsgElement.textContent = finalMessage;
                 container.appendChild(finalMsgElement);
            }

            // 4. Atualiza Rodapé
            updateFooterYear();
            console.log("Processo de carregamento finalizado.");
        });
    </script>

</body>
</html>