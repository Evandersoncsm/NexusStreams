<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Streams - Músicas do Brasil e do Mundo</title>
    <link rel="icon" type="image/x-icon" href="https://png.pngtree.com/png-vector/20230309/ourmid/pngtree-letter-n-logo-vector-png-image_6639640.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos gerais */
        body { background-color: #0f0f0f; color: #e1e1e1; font-family: 'Inter', sans-serif; }
        .music-card:hover .card-image-overlay, .music-card:hover .play-icon { opacity: 1; }
        .music-card:hover .play-icon { transform: scale(1.1); }
        .music-card:hover .track-title { color: #ffffff; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background-color: #404040; border-radius: 4px; border: 2px solid #1a1a1a; }
        ::-webkit-scrollbar-thumb:hover { background-color: #555; }
        .play-icon::before { content: '▶'; font-size: 1.5rem; color: rgba(255, 255, 255, 0.9); }

        /* Utilitários */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .truncate-1-line { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .music-card { box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); }
        .music-card:hover { box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4); }

        /* Estilos Music Card */
        .music-card .card-image {
            aspect-ratio: 1 / 1;
            object-fit: cover;
            background-color: #2a2a2a;
        }
         .music-card .play-icon::before {
             font-size: 1.2rem;
         }
        .music-card:hover .card-image {
            filter: brightness(0.85);
        }

        /* Estilos Player Fixo */
        #player-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: rgba(26, 26, 26, 0.95); /* #1a1a1a com transparência */
            backdrop-filter: blur(5px);
            padding: 10px 20px;
            border-top: 1px solid #303030;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
        }
        #player-info {
            flex-grow: 1;
            text-align: left;
            min-width: 0; /* Para o truncate funcionar no flex item */
        }
        #player-info .title { font-weight: 600; }
        #player-info .artist { font-size: 0.85em; color: #a0a0a0; }
         #audio-player {
             width: 100%;
             max-width: 400px;
             height: 40px; /* Ajusta altura */
         }
         #player-container.hidden {
             display: none;
         }

         /* Estilos Botões de Gênero */
         .genre-button {
             background-color: #374151; /* gray-700 */
             color: #e5e7eb; /* gray-200 */
             padding: 0.3rem 0.8rem;
             border-radius: 9999px; /* full */
             font-size: 0.8rem;
             font-weight: 500;
             transition: background-color 0.2s ease-in-out, transform 0.1s ease;
             border: 1px solid #4b5563; /* gray-600 */
             cursor: pointer; /* Adiciona cursor pointer */
         }
         .genre-button:hover {
             background-color: #1d4ed8; /* blue-700 */
             border-color: #2563eb; /* blue-600 */
             transform: translateY(-1px);
         }
          .genre-button:active {
              transform: translateY(0);
          }

    </style>
</head>
<body class="antialiased pb-24">

    <header class="bg-gradient-to-b from-black/90 via-black/70 to-transparent sticky top-0 z-50 py-3 sm:py-4 px-4 sm:px-6">
        <nav class="container mx-auto px-0 sm:px-6 flex flex-wrap justify-between items-center">
            <a href="index.html" class="text-2xl sm:text-3xl font-bold text-red-600 tracking-wide hover:text-red-500 transition duration-300">Nexus Streams</a>
            <div class="space-x-3 sm:space-x-5 mt-2 sm:mt-0">
                <a href="index.html#ao-vivo" class="text-gray-300 hover:text-white transition duration-200 text-sm sm:text-base font-medium">Ao Vivo</a>
                <a href="index.html#radios" class="text-gray-300 hover:text-white transition duration-200 text-sm sm:text-base font-medium">Rádios</a>
                <a href="streams.html" class="text-gray-300 hover:text-white transition duration-200 text-sm sm:text-base font-medium">Filmes & Séries</a>
                <a href="index.html#destaques" class="text-gray-300 hover:text-white transition duration-200 text-sm sm:text-base font-medium">Destaques</a>
                <a href="index.html#noticias" class="text-gray-300 hover:text-white transition duration-200 text-sm sm:text-base font-medium">Notícias</a>
                <a href="creditos.html" class="text-white font-semibold transition duration-200 text-sm sm:text-base">Créditos</a>
            </div>
        </nav>
    </header>
    <section class="container mx-auto px-4 sm:px-6 py-8 md:py-12 text-center bg-gray-900/30 rounded-lg mb-10 mt-4 sm:mb-12 shadow-lg border border-gray-800/50">
        <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-white mb-3 sm:mb-4">Explore Músicas do Brasil e do Mundo</h1>
        <p class="text-base sm:text-lg text-gray-300 mb-6 max-w-2xl mx-auto">Busque ou explore por gênero e ouça prévias de músicas.</p>
        <div class="max-w-lg mx-auto px-2 sm:px-0">
             <div class="relative">
                 <input type="search" id="search-input" placeholder="Buscar músicas, artistas..."
                        class="w-full py-2.5 px-4 sm:py-3 sm:px-5 bg-gray-800/70 border border-gray-700 rounded-full text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-300 shadow-sm text-sm sm:text-base">
                 <button id="search-button" class="absolute right-0 top-0 bottom-0 px-4 text-gray-400 hover:text-blue-500" aria-label="Buscar">
                     <svg class="h-4 w-4 sm:h-5 sm:w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                     </svg>
                 </button>
             </div>
        </div>
         <div id="genre-buttons" class="mt-6 flex flex-wrap justify-center gap-2 sm:gap-3 px-2">
            <button class="genre-button" data-genre="música popular brasileira">MPB</button>
            <button class="genre-button" data-genre="sertanejo">Sertanejo</button>
            <button class="genre-button" data-genre="samba">Samba</button>
            <button class="genre-button" data-genre="pagode">Pagode</button>
            <button class="genre-button" data-genre="funk carioca">Funk Carioca</button>
             <button class="genre-button" data-genre="forró">Forró</button>
            <button class="genre-button" data-genre="pop brasil">Pop Brasil</button>
            <button class="genre-button" data-genre="rock brasil">Rock Brasil</button>
            <button class="genre-button" data-genre="pop">Pop</button>
            <button class="genre-button" data-genre="rock">Rock</button>
            <button class="genre-button" data-genre="electronic">Eletrônica</button>
            <button class="genre-button" data-genre="hip hop">Hip Hop</button>
        </div>
    </section>

    <div class="container mx-auto px-4 sm:px-6"> <section id="top-brasil-results" aria-live="polite" class="mb-12 sm:mb-16">
            <h2 id="top-brasil-title" class="text-2xl sm:text-3xl font-semibold mb-6 sm:mb-8 text-white border-l-4 border-blue-500 pl-3 sm:pl-4">Top Brasil</h2>
            <p id="top-brasil-loading" class="text-center text-gray-400">Carregando Top Brasil...</p>
            <div id="top-brasil-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6">
                </div>
        </section>

        <section id="most-played-results" aria-live="polite" class="mb-12 sm:mb-16">
            <h2 id="most-played-title" class="text-2xl sm:text-3xl font-semibold mb-6 sm:mb-8 text-white border-l-4 border-red-500 pl-3 sm:pl-4">Mais Tocadas</h2>
            <p id="most-played-loading" class="text-center text-gray-400">Carregando Mais Tocadas...</p>
            <div id="most-played-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6">
                </div>
        </section>

        <section id="music-results" aria-live="polite" class="mb-12 sm:mb-16" style="display: none;"> <h2 id="results-title" class="text-2xl sm:text-3xl font-semibold mb-6 sm:mb-8 text-white border-l-4 border-green-500 pl-3 sm:pl-4">Resultados da Busca</h2>
            <p id="loading-message" class="text-center text-gray-400" style="display: none;"></p> <div id="music-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6">
                </div>
        </section>

    </div> <div id="player-container" class="hidden"> <div id="player-info" class="text-white truncate-1-line">
             <span id="player-title" class="title block truncate-1-line">Nenhuma prévia tocando</span>
             <span id="player-artist" class="artist block truncate-1-line"></span>
         </div>
        <audio id="audio-player" controls>
            Seu navegador não suporta o elemento de áudio.
        </audio>
    </div>

    <footer class="bg-black mt-12 sm:mt-16 py-6 sm:py-8 border-t border-gray-800">
        <div class="container mx-auto px-4 sm:px-6 text-center text-gray-500 text-xs sm:text-sm">
            &copy; <span id="current-year"></span> Nexus Streams. Todos os direitos reservados.
        </div>
    </footer>

    <script>
        // --- Constantes e Variáveis Globais ---
        const DEEZER_API_BASE_URL = 'https://api.deezer.com/search';
        const tracksLimit = 12; // Número de faixas por seção

        // Elementos do DOM gerais
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const audioPlayer = document.getElementById('audio-player');
        const playerContainer = document.getElementById('player-container');
        const playerTitle = document.getElementById('player-title');
        const playerArtist = document.getElementById('player-artist');
        const footerYearSpan = document.getElementById('current-year');
        const genreButtonContainer = document.getElementById('genre-buttons');

        // Elementos das seções específicas
        const topBrasilGrid = document.getElementById('top-brasil-grid');
        const topBrasilTitle = document.getElementById('top-brasil-title');
        const topBrasilLoading = document.getElementById('top-brasil-loading');

        const mostPlayedGrid = document.getElementById('most-played-grid');
        const mostPlayedTitle = document.getElementById('most-played-title');
        const mostPlayedLoading = document.getElementById('most-played-loading');

        const searchResultsSection = document.getElementById('music-results'); // Seção de busca
        const searchResultsGrid = document.getElementById('music-grid');      // Grid da busca
        const searchResultsTitle = document.getElementById('results-title');   // Título da busca
        const searchLoadingMessage = document.getElementById('loading-message'); // Loading da busca

        let currentJsonpScripts = {}; // Objeto para gerenciar múltiplos scripts/callbacks

        // --- Funções ---

        /**
         * Limpa o script JSONP e a função callback global associada.
         * @param {string} callbackName - O nome da função callback a ser removida.
         */
        function cleanupJsonp(callbackName) {
            const script = currentJsonpScripts[callbackName];
            if (script && script.parentNode) {
                script.parentNode.removeChild(script);
            }
            delete currentJsonpScripts[callbackName];

            if (callbackName && typeof window[callbackName] === 'function') {
                try {
                    delete window[callbackName];
                } catch (e) {
                    window[callbackName] = undefined;
                }
            }
        }

        /**
         * Busca músicas na API usando JSONP e atualiza a seção correta.
         * @param {string} searchTerm - O termo a ser buscado.
         * @param {HTMLElement} gridElement - O elemento da grade onde exibir os resultados.
         * @param {HTMLElement} titleElement - O elemento do título da seção.
         * @param {HTMLElement} loadingElement - O elemento da mensagem de carregamento.
         * @param {string} sectionTitle - O título descritivo para a seção.
         */
        function fetchMusicJsonp(searchTerm, gridElement, titleElement, loadingElement, sectionTitle) {
            const trimmedSearchTerm = searchTerm.trim();

             if (!gridElement || !titleElement || !loadingElement) {
                 console.error(`Elementos DOM faltando para a busca de "${searchTerm}". Abortando.`);
                 if(loadingElement) {
                    loadingElement.textContent = "Erro interno ao carregar.";
                    loadingElement.style.display = 'block';
                 }
                 return;
             }

            if (gridElement === searchResultsGrid && !trimmedSearchTerm) {
                 titleElement.textContent = "Resultados da Busca";
                 loadingElement.textContent = 'Por favor, digite um termo ou clique em um gênero para buscar.';
                 loadingElement.style.display = 'block';
                 gridElement.innerHTML = '';
                 if (searchResultsSection) searchResultsSection.style.display = 'block';
                 return;
             }

             const displaySearchTerm = trimmedSearchTerm.length > 30 ? trimmedSearchTerm.substring(0, 27) + '...' : trimmedSearchTerm;
             titleElement.textContent = sectionTitle;
             loadingElement.textContent = `Buscando por "${displaySearchTerm}"...`;
             loadingElement.style.display = 'block';
             gridElement.innerHTML = '';

            const callbackName = `nexusCallback_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;

            window[callbackName] = function(data) {
                if (data && data.data && data.data.length > 0) {
                    displayTracks(data.data, gridElement);
                    loadingElement.style.display = 'none';
                } else {
                    loadingElement.textContent = `Nenhuma prévia encontrada para "${displaySearchTerm}".`;
                    loadingElement.style.display = 'block';
                }
                cleanupJsonp(callbackName);
            };

            const apiUrl = `${DEEZER_API_BASE_URL}?q=${encodeURIComponent(trimmedSearchTerm)}&limit=${tracksLimit}&output=jsonp&callback=${callbackName}`;

            const script = document.createElement('script');
            script.src = apiUrl;
            script.onerror = function() {
                console.error(`Erro ao carregar o script JSONP para: ${apiUrl} (Callback: ${callbackName})`);
                titleElement.textContent = `Erro - ${sectionTitle}`;
                loadingElement.textContent = 'Erro de rede ao buscar. Verifique sua conexão e tente novamente.';
                loadingElement.style.display = 'block';
                cleanupJsonp(callbackName);
            };

            currentJsonpScripts[callbackName] = script;
            document.body.appendChild(script);
        }

        /**
         * Exibe os cards de música na grade especificada.
         * @param {Array} tracks - Array de objetos de música da API.
         * @param {HTMLElement} gridElement - O elemento da grade onde os cards serão adicionados.
         */
        function displayTracks(tracks, gridElement) {
            if (!gridElement) {
                 console.error("Tentativa de exibir tracks sem um gridElement válido.");
                 return;
            }
            gridElement.innerHTML = '';

            tracks.forEach(track => {
                if (!track.preview || !track.title || !track.artist?.name || !track.album?.cover_medium) {
                    console.warn(`Faixa pulada por falta de dados essenciais: ID ${track.id}, Título: ${track.title}`);
                    return;
                }

                const card = document.createElement('div');
                card.className = 'music-card group block bg-gray-800 rounded-lg overflow-hidden transform transition duration-300 ease-in-out hover:scale-105 relative border border-transparent hover:border-blue-500/50 cursor-pointer';
                const artworkUrl = track.album.cover_medium;

                card.innerHTML = `
                    <div class="relative">
                        <img src="${artworkUrl}" alt="Capa de ${track.title}" class="card-image w-full transition-transform duration-300" loading="lazy">
                        <div class="card-image-overlay absolute inset-0 bg-gradient-to-t from-black/70 via-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-10"></div>
                        <div class="play-icon absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform scale-90 group-hover:scale-100 z-10" aria-hidden="true"></div>
                    </div>
                    <div class="p-2 sm:p-3 text-center bg-gray-800">
                        <span class="track-title block text-gray-300 text-xs sm:text-sm font-semibold transition-colors duration-300 truncate-1-line" title="${track.title}">${track.title_short || track.title}</span>
                        <span class="track-artist block text-gray-400 text-xs font-medium truncate-1-line" title="${track.artist.name}">${track.artist.name}</span>
                    </div>
                `;
                card.addEventListener('click', () => {
                    playTrack(track.preview, track.title, track.artist.name, artworkUrl);
                });
                gridElement.appendChild(card);
            });
        }

        /**
         * Carrega e toca uma PRÉVIA de música no player.
         */
        function playTrack(audioSrc, trackName, artistName, artworkUrl) {
             audioPlayer.src = audioSrc;
             playerTitle.textContent = `${trackName} (Prévia)`;
             playerTitle.title = trackName;
             playerArtist.textContent = artistName;
             playerArtist.title = artistName;
             playerContainer.classList.remove('hidden');
             audioPlayer.load();
             audioPlayer.play().catch(e => {
                 console.error("Erro ao tocar prévia:", e);
             });
        }

        /**
         * Atualiza o ano no rodapé.
         */
        function updateFooterYear() {
            if (footerYearSpan) {
                const currentYear = new Date().getFullYear();
                footerYearSpan.textContent = currentYear;
            }
        }

        // --- Event Handlers ---

        /**
         * Lida com a busca do usuário, exibindo resultados na seção de busca.
         */
        function handleSearch() {
            if (!searchResultsSection || !searchResultsGrid || !searchResultsTitle || !searchLoadingMessage) {
                console.error("Elementos da seção de busca não encontrados. A busca não pode ser realizada.");
                return;
            }
            const searchTerm = searchInput.value;
            const displaySearchTerm = searchTerm.trim().length > 30 ? searchTerm.trim().substring(0, 27) + '...' : searchTerm.trim();
            searchResultsSection.style.display = 'block';
            fetchMusicJsonp(searchTerm, searchResultsGrid, searchResultsTitle, searchLoadingMessage, `Resultados para "${displaySearchTerm || '...'}"`);
        }

        /**
         * Lida com o clique em um botão de gênero, exibindo resultados na seção de busca.
         */
        function handleGenreClick(event) {
             const button = event.target.closest('.genre-button');
             if (button) {
                 const genre = button.dataset.genre;
                 if (genre) {
                    if (!searchResultsSection || !searchResultsGrid || !searchResultsTitle || !searchLoadingMessage) {
                        console.error("Elementos da seção de busca não encontrados. A busca por gênero não pode ser realizada.");
                        return;
                    }
                    searchResultsSection.style.display = 'block';
                    fetchMusicJsonp(genre, searchResultsGrid, searchResultsTitle, searchLoadingMessage, `Resultados para Gênero: "${genre}"`);
                 }
             }
        }

        // --- Inicialização ---
        function initialize() {
            updateFooterYear();

            if (searchButton && searchInput) {
                 searchButton.addEventListener('click', handleSearch);
                 searchInput.addEventListener('keydown', (event) => {
                     if (event.key === 'Enter') {
                         event.preventDefault();
                         handleSearch();
                     }
                 });
            } else {
                 console.error("Botão ou input de busca não encontrado.");
            }

             if (genreButtonContainer) {
                 genreButtonContainer.addEventListener('click', handleGenreClick);
             } else {
                 console.error("Container de botões de gênero não encontrado.");
             }

            if (topBrasilGrid && topBrasilTitle && topBrasilLoading) {
                 fetchMusicJsonp('top brasil', topBrasilGrid, topBrasilTitle, topBrasilLoading, "Top Brasil");
             } else {
                 console.error("Elementos para 'Top Brasil' não encontrados.");
                 if (topBrasilLoading) { topBrasilLoading.textContent = "Erro ao carregar seção."; topBrasilLoading.style.display = 'block';}
             }

             if (mostPlayedGrid && mostPlayedTitle && mostPlayedLoading) {
                 fetchMusicJsonp('top hits global', mostPlayedGrid, mostPlayedTitle, mostPlayedLoading, "Mais Tocadas (Global)");
             } else {
                 console.error("Elementos para 'Mais Tocadas' não encontrados.");
                 if (mostPlayedLoading) { mostPlayedLoading.textContent = "Erro ao carregar seção."; mostPlayedLoading.style.display = 'block';}
             }
        }

        // Garante que o DOM está pronto antes de rodar o script
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }

    </script>

</body>
</html>
